<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Session Queue · TBAG</title>
<link rel="stylesheet" href="/static/styles.css">
<style>
/* ---- page-specific rules (material-ish) -------------------------------- */
:root{
  --card-bg:#fff; --e1:0 2px 6px rgba(0,0,0,.08);
  --e2:0 4px 12px rgba(0,0,0,.12); --gap:1.8rem;
}
h2{margin-top:0}
.card{background:var(--card-bg);border-radius:14px;box-shadow:var(--e1);}
.card:hover{box-shadow:var(--e2);}
.btn{background:#27286f;color:#fff;border:none;padding:.7rem 1.8rem;
     border-radius:8px;font-size:1rem;cursor:pointer}
table{width:100%;border-collapse:collapse;font-size:.95rem}
th,td{padding:.55rem 1rem;text-align:left}
tr:not(:last-child) td{border-bottom:1px solid #eee}
.status-pending {color:#c98200;font-weight:600}
.status-active  {color:#0069d9;font-weight:600}
.status-finished{color:#28a745;font-weight:600}
.status-aborted {color:#dc3545;font-weight:600}
.delete-btn{background:#27286f;color:#fff;border-radius:8px;
            width:38px;height:38px;display:grid;place-items:center}
.grid{display:grid;gap:var(--gap);grid-template-columns:1fr 1fr}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header class="appbar">
  <img src="/static/logo.png" alt="logo"><h1>Session Queue</h1>
</header>

<main class="content">
<div class="grid">

  <!-- create form -->
  <section class="card" style="padding:2.2rem">
    <h2>Create New Session</h2>
    <form action="/admin/sessions/new" method="post"
          class="flex-row" style="gap:.6rem;margin-top:1.4rem">
      <select name="project" required>
        <option value="" disabled selected>Select project…</option>
        {% for p in projects %}
          <option value="{{p.id}}">{{p.name}}</option>
        {% endfor %}
      </select>
      <input name="stack_id" placeholder="Stack ID" required>
      <input name="operator" placeholder="Operator" required>
      <button class="btn">Add Session</button>
    </form>
  </section>

  <!-- live table -->
  <section class="card" style="padding:2.2rem">
    <h2>Pending / Active Runs</h2>
    <div style="overflow-x:auto;margin-top:1rem">
      <table id="sessTbl"><thead>
        <tr><th>Created</th><th>Project</th><th>Stack</th>
            <th>Operator</th><th>Status</th><th></th></tr>
      </thead><tbody></tbody></table>
    </div>
  </section>

</div>
</main>

<script>
const tbody = document.querySelector('#sessTbl tbody');

function rowMarkup(r){
  const cls='status-'+r.status;
  const delBtn = r.status==='pending'
    ? `<form method="post"
            action="/admin/sessions/${r.session_id}/delete" style="margin:0">
         <button class="delete-btn" title="Remove">&#10005;</button>
       </form>` : '';
  return `<tr>
    <td>${r.ts_created.replace('T',' ')}</td>
    <td>${r.project}</td><td>${r.stack_id}</td><td>${r.operator}</td>
    <td class="${cls}">${r.status}</td><td>${delBtn}</td>
  </tr>`;
}

async function refresh(){
  const rows = await fetch('/admin/sessions/json').then(r=>r.json());
  tbody.innerHTML = rows.map(rowMarkup).join('');
}
refresh(); setInterval(refresh, 2500);      // ← refresh every 2.5 s
</script>
</body>
</html>
